angular.module("ez.timepicker",[]).constant("TimepickerConfig",{yearStep:1,monthStep:1,dayStep:1,hourStep:1,minuteStep:1,secondStep:1,meridians:["AM","PM"],showYear:"false",showMonth:"false",showDay:"false",showHour:"true",showMinute:"true",showSecond:"true",showMeridian:"false",inputContainerClass:"input-group",incIconClass:"icon-chevron-up",decIconClass:"icon-chevron-down"}).directive("ezTimepicker",["TimepickerConfig",function(e){return{require:"ngModel",restrict:"EA",replace:!0,transclude:"element",templateUrl:"ez-timepicker.html",scope:{time:"=ezTimepicker",disabled:"=ngDisabled"},link:function(n,i,t,s){function d(e){e=Number(e);var i=Math.floor(e/3600),t=Math.floor(e%3600/60),s=Math.floor(e%3600%60);n.widget.hours=i,n.widget.minutes=t,n.widget.seconds=s}_scope=n,_element=i,_attrs=t,n.yearStep=parseInt(t.yearStep,1)||e.yearStep,n.monthStep=parseInt(t.monthStep,1)||e.monthStep,n.dayStep=parseInt(t.dayStep,1)||e.dayStep,n.hourStep=parseInt(t.hourStep,1)||e.hourStep,n.minuteStep=parseInt(t.minuteStep,1)||e.minuteStep,n.secondStep=parseInt(t.secondStep,1)||e.secondStep,n.showYear=n.$eval(t.showYear||e.showYear),n.showMonth=n.$eval(t.showMonth||e.showMonth),n.showDay=n.$eval(t.showDay||e.showDay),n.showHour=n.$eval(t.showHour||e.showHour),n.showMinute=n.$eval(t.showMinute||e.showMinute),n.showSecond=n.$eval(t.showSecond||e.showSecond),n.showMeridian=n.$eval(t.showMeridian||e.showMeridian),n.meridians=t.meridians||e.meridians,n.inputContainerClass=t.inputContainerClass||e.inputContainerClass,n.incIconClass=t.incIconClass||e.incIconClass,n.decIconClass=t.decIconClass||e.decIconClass,n.widget={years:0,months:0,days:0,minutesAsSeconds:0,totalSeconds:0},s.$render=function(){n.widget.totalSeconds=s.$viewValue,d(s.$viewValue)},n.preventDefault=function(e){e.preventDefault(),e.stopPropagation()},n.incrementYears=function(){n.widget.years++},n.decrementYears=function(){n.widget.years>0&&n.widget.years--},n.incrementMonths=function(){n.widget.months++,13===n.widget.months&&(n.incrementYears(),n.widget.months=1)},n.decrementMonths=function(){parseInt(n.widget.months,10)?n.widget.months--:(n.decrementYears(),n.widget.months=12)},n.incrementDays=function(){n.widget.days++,32===n.widget.days&&n.showMonth&&(n.incrementMonths(),n.widget.days=1)},n.decrementDays=function(){parseInt(n.widget.days,10)?n.widget.days--:(n.decrementMonths(),n.widget.days=31)},n.incrementHours=function(){n.showMeridian?11===n.widget.hours?(n.widget.hours++,"PM"===n.widget.meridians&&(n.incrementDays(),n.widget.hours=0),n.toggleMeridian()):12===n.widget.hours?n.widget.hours=1:n.widget.hours++:23===n.widget.hours?(n.widget.hours=0,n.incrementDays()):n.widget.hours++,a()},n.decrementHours=function(){parseInt(n.widget.hours,10)?n.widget.hours--:(n.showMeridian?n.widget.hours=12:n.widget.hours=23,"AM"===n.widget.meridians&&n.decrementDays()),11===n.widget.hours&&n.showMeridian&&n.toggleMeridian(),a()},n.incrementMinutes=function(){n.widget.minutes=parseInt(n.widget.minutes,10)+n.minuteStep,n.widget.minutes>=60&&(n.widget.minutes=0,n.incrementHours()),o()},n.decrementMinutes=function(){n.widget.minutes=n.widget.minutes-n.minuteStep,parseInt(n.widget.minutes,10)<0&&(n.decrementHours(),n.widget.minutes+=60),o()},n.incrementSeconds=function(){n.widget.seconds=parseInt(n.widget.seconds,10)+n.secondStep,n.widget.seconds>=60&&(n.widget.seconds=0,n.incrementMinutes()),c()},n.decrementSeconds=function(){n.widget.seconds=n.widget.seconds-n.secondStep,parseInt(n.widget.seconds,10)<0&&(n.decrementMinutes(),n.widget.seconds+=60),c()},n.toggleMeridian=function(){n.widget.meridian===n.meridians[0]?n.widget.meridian=n.meridians[1]:n.widget.meridian=n.meridians[0]};var a=function(){parseInt(n.widget.hours,10)<10&&(n.widget.hours="0"+parseInt(n.widget.hours,10))},o=function(){parseInt(n.widget.minutes,10)>=60&&(n.widget.minutes=0,n.incrementHours()),parseInt(n.widget.minutes,10)<10&&(n.widget.minutes="0"+parseInt(n.widget.minutes,10)),n.widget.minutesAsSeconds=60*parseInt(n.widget.minutes,10)},c=function(){parseInt(n.widget.seconds,10)>=60&&(n.widget.seconds=0,n.incrementMinutes()),parseInt(n.widget.seconds,10)<10&&(n.widget.seconds="0"+parseInt(n.widget.seconds,10))},r=function(){n.time=n.widget.hours+":"+n.widget.minutes+":"+n.widget.seconds,n.showDay&&n.widget.days&&(n.time=n.widget.days+" days "+n.time),n.showMonth&&n.widget.months&&(n.time=n.widget.months+(n.widget.months>1?" months ":" month ")+n.time),n.showYear&&n.widget.years&&(n.time=n.widget.years+(n.widget.years>1?" years ":" year ")+n.time),n.showMeridian&&(n.time=n.time+" "+n.widget.meridian)},l=function(){if(angular.isDefined(n.widget.hours)&&angular.isDefined(n.widget.minutes)){r(),i.find("input").first().val(n.time);var e=60*parseInt(n.widget.hours,10)*60+n.widget.minutesAsSeconds+parseInt(n.widget.seconds,10);s.$setViewValue(e)}else g(n.time)},u=function(e){e.originalEvent&&(e=e.originalEvent);var n=e.wheelDelta?e.wheelDelta:-e.deltaY;return e.detail||n>0},g=function(e){var i,t,s,d,l,u;e?(e.match(new RegExp(n.meridians[1].substring(0,1),"i"))?n.widget.meridian=n.meridians[1]:n.widget.meridian=n.meridians[0],match=/(?:([0-9]*)years?)?(?:([0-9]*)months?)?(?:([0-9]*)days?)?(?:([0-9]*):)?(?:([0-9]*):)?(?:([0-9]*))?/.exec(e.replace(/ /g,"")),i=match[1]?match[1].toString():"",t=match[2]?match[2].toString():"",s=match[3]?match[3].toString():"",d=match[4]?match[4].toString():"",l=match[5]?match[5].toString():"",u=match[6]?match[6].toString():"",d.length>2&&(l=d.substr(2,2),d=d.substr(0,2)),l.length>2&&(l=l.substr(0,2)),u.length>2&&(u=u.substr(0,2)),i=parseInt(i,10),t=parseInt(t,10),s=parseInt(s,10),d=parseInt(d,10),l=parseInt(l,10),u=parseInt(u,10),isNaN(i)&&(i=0),isNaN(t)&&(t=0),isNaN(s)&&(s=0),isNaN(d)&&(d=0),isNaN(l)&&(l=0),isNaN(u)&&(u=0)):(new Date,i=0,t=0,s=0,d=0,l=0,u=0),n.showMeridian?0===d?n.widget.hours=12:d>12?(n.widget.hours=d-12,n.widget.meridian?n.widget.meridian=n.widget.meridian===n.meridians[0]?n.meridians[1]:n.meridians[0]:n.widget.meridian=n.meridians[1]):n.widget.hours=d:n.widget.hours=d,n.widget.minutes=Math.ceil(l/n.minuteStep)*n.minuteStep,n.widget.seconds=Math.ceil(u/n.secondStep)*n.secondStep,a(),o(),c(),r()};n.setTime=g;var w=i.find("input").first();w.on("blur",function(){n.$apply(function(){g(w.val())})}),n.$watch("widget",function(e){l()},!0),n.$watch("time",function(e){g(e)},!0),i.find(".years-col").on("mousewheel wheel",function(e){n.$apply(u(e)?n.incrementYears():n.decrementYears()),e.preventDefault()}),i.find(".months-col").on("mousewheel wheel",function(e){n.$apply(u(e)?n.incrementMonths():n.decrementMonths()),e.preventDefault()}),i.find(".days-col").on("mousewheel wheel",function(e){n.$apply(u(e)?n.incrementDays():n.decrementDays()),e.preventDefault()}),i.find(".hours-col").on("mousewheel wheel",function(e){n.$apply(u(e)?n.incrementHours():n.decrementHours()),e.preventDefault()}),i.find(".minutes-col").on("mousewheel wheel",function(e){n.$apply(u(e)?n.incrementMinutes():n.decrementMinutes()),e.preventDefault()}),i.find(".seconds-col").on("mousewheel wheel",function(e){n.$apply(u(e)?n.incrementSeconds():n.decrementSeconds()),e.preventDefault()}),i.find(".meridian-col").on("mousewheel wheel",function(e){n.$apply(n.toggleMeridian()),e.preventDefault()})}}}]).run(["$templateCache",function(e){"use strict";e.put("ez-timepicker.html",'<div class="dropdown ez-timepicker-container" uib-dropdown>\n <div id="cover" ng-show="disabled"></div>\n  <div class="dropdown-toggle" ng-class="inputContainerClass" uib-dropdown-toggle>\n    <div class="time-input" ng-transclude></div>\n  </div>\n  <div class="dropdown-menu" ng-click="preventDefault($event)">\n    <div class="col years-col" ng-show="showYear">\n      <div class="text">Y</div>\n      <div><a class="button" ng-click="incrementYears()"><i ng-class="incIconClass"></i></a></div>\n      <div class="years-val">{{ widget.years }}</div>\n      <div><a class="button" ng-click="decrementYears()"><i ng-class="decIconClass"></i></a></div>\n    </div>\n    <div class="col months-col" ng-show="showMonth">\n      <div class="text">M</div>\n      <div><a class="button" ng-click="incrementMonths()"><i ng-class="incIconClass"></i></a></div>\n      <div class="months-val">{{ widget.months }}</div>\n      <div><a class="button" ng-click="decrementMonths()"><i ng-class="decIconClass"></i></a></div>\n    </div>\n    <div class="col days-col" ng-show="showDay">\n      <div class="text">D</div>\n      <div><a class="button" ng-click="incrementDays()"><i ng-class="incIconClass"></i></a></div>\n      <div class="days-val">{{ widget.days }}</div>\n      <div><a class="button" ng-click="decrementDays()"><i ng-class="decIconClass"></i></a></div>\n    </div>\n    <div class="col hours-col" ng-show="showHour">\n      <div class="text">H</div>\n      <div><a class="button" ng-click="incrementHours()"><i ng-class="incIconClass"></i></a></div>\n      <div class="hours-val">{{ widget.hours }}</div>\n      <div><a class="button" ng-click="decrementHours()"><i ng-class="decIconClass"></i></a></div>\n    </div>\n    <div class="col minutes-col" ng-show="showMinute">\n      <div class="text">M</div>\n      <div><a class="button" ng-click="incrementMinutes()"><i ng-class="incIconClass"></i></a></div>\n      <div class="minutes-val">{{ widget.minutes }}</div>\n      <div><a class="button" ng-click="decrementMinutes()"><i ng-class="decIconClass"></i></a></div>\n    </div>\n    <div class="col seconds-col" ng-show="showSecond">\n      <div class="text">S</div>\n      <div><a class="button" ng-click="incrementSeconds()"><i ng-class="incIconClass"></i></a></div>\n      <div class="seconds-val">{{ widget.seconds }}</div>\n      <div><a class="button" ng-click="decrementSeconds()"><i ng-class="decIconClass"></i></a></div>\n    </div>\n    <div class="col meridian-col" ng-show="showMeridian">\n      <div class="text">A</div>\n      <div><a class="button" ng-click="toggleMeridian()"><i ng-class="incIconClass"></i></a></div>\n      <div class="meridian-val" ng-click="toggleMeridian()">{{ widget.meridian }}</div>\n      <div><a class="button" ng-click="toggleMeridian()"><i ng-class="decIconClass"></i></a></div>\n    </div>\n  </div>\n</div>\n')}]);